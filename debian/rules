#!/usr/bin/make -f

export PYBUILD_NAME=borednomore3
export DH_VERBOSE=1

%:
	dh $@ --with python3 --buildsystem=pybuild

override_dh_auto_clean:
	dh_auto_clean
	find . -type f -name "*.pyc" -delete
	find . -type d -name "__pycache__" -delete
	rm -rf build/ dist/ *.egg-info/

override_dh_auto_build:
	# Python packages are already structured, no build needed

override_dh_auto_install:
	dh_auto_install
	
	# Create directories
	install -d debian/borednomore3/usr/bin
	install -d debian/borednomore3/usr/lib/borednomore3
	install -d debian/borednomore3/etc/borednomore3
	install -d debian/borednomore3/usr/share/borednomore3/wallpapers
	install -d debian/borednomore3/usr/share/man/man1
	install -d debian/borednomore3/usr/share/applications
	install -d debian/borednomore3/usr/share/doc/borednomore3
	
	# Copy library structure
	cp -r borednomore3/libs debian/borednomore3/usr/lib/borednomore3/
	find debian/borednomore3/usr/lib/borednomore3/libs -type f -name "*.py" -exec chmod 644 {} \;
	find debian/borednomore3/usr/lib/borednomore3/libs -type d -exec chmod 755 {} \;
	
	# Install backend
	install -m 755 borednomore3/backend/borednomore3.py debian/borednomore3/usr/lib/borednomore3/
	
	# Install frontend
	install -m 755 borednomore3/frontend/bnm3.py debian/borednomore3/usr/lib/borednomore3/
	
	# Install downloader
	install -m 755 borednomore3_downloader.py debian/borednomore3/usr/bin/borednomore3-downloader
	
	# Create wrapper scripts
	echo '#!/bin/bash\nexec python3 /usr/lib/borednomore3/borednomore3.py "$$@"' > debian/borednomore3/usr/bin/borednomore3
	chmod 755 debian/borednomore3/usr/bin/borednomore3
	
	echo '#!/bin/bash\nexec python3 /usr/lib/borednomore3/bnm3.py "$$@"' > debian/borednomore3/usr/bin/borednomore3-gui
	chmod 755 debian/borednomore3/usr/bin/borednomore3-gui
	
	# Install config examples
	install -m 644 borednomore3/conf/borednomore3.conf-example debian/borednomore3/etc/borednomore3/borednomore3.conf
	install -m 644 borednomore3/conf/borednomore3.list-example debian/borednomore3/etc/borednomore3/borednomore3.list
	
	# Install docs
	install -m 644 README.md debian/borednomore3/usr/share/doc/borednomore3/
	install -m 644 DOWNLOADER.md debian/borednomore3/usr/share/doc/borednomore3/

override_dh_installman:
	dh_installman
	gzip -9 debian/borednomore3/usr/share/man/man1/*.1

override_dh_compress:
	dh_compress -X.md
